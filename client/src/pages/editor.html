<template>
  <require from="./editor.css"></require>
  <require from="elements/schema-editor/schema-editor"></require>
  <require from="elements/item-preview/item-preview"></require>
  <require from="elements/organisms/tool-status-bar"></require>
  <q-bar if.bind="user.isLoggedIn" router.bind="router">
    <a slot="back-button" class="q-bar__back" route-href="route: index">
      <button-secondary icon="back" icon-size="medium"></button-secondary>
    </a>
    <tool-status-bar slot="tool-status-bar" item.bind="item" save-action.call="userSave()"></tool-status-bar>
  </q-bar>
  <section class="editor">
    <main>
      <q-messages></q-messages>
      <section>
        <form ref="form" class="q-form" validate>
          <schema-editor schema.bind="schema" data.bind="item.conf" change.call="handleChange()">
            <h2>${ 'editor.title' & t }</h2>
          </schema-editor>
          <button ref="formSubmitButton" type="submit" style="display: none;"></button>
        </form>
      </section>
      <section class="editor__preview-container">
        <h2>${ 'preview.title' & t }</h2>
        <div class="editor__preview">
          <div class="editor__options" if.bind="optionsSchema">
            <form ref="optionsForm" class="q-form" validate>
              <schema-editor schema.bind="optionsSchema" data.bind="item.conf.options" change.call="handleChange()">
                <h6>${optionsSchema.title || 'Optionen'}</h6>
              </schema-editor>
              <button ref="optionsFormSubmitButton" type="submit" style="display: none;"></button>
            </form>
          </div>
          <item-preview data.bind="previewData"></item-preview>
        </div>
      </section>
      <section>
        <h2>${ 'metaEditor.title' & t }</h2>
        <meta-editor data.bind="item.conf" change.call="handleChange()"></meta-editor>
      </section>
    </main>
  </section>
</template>
